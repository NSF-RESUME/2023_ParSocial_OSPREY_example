# Could do this with a list of named pools
# pools:
# - name: "local"
#   cfg: ...
# - name: "bebop"
#   cfg: ...

pools:
  - name: nc_local
    type: local
    start_pool_script: /home/nick/Documents/repos/eqsql_examples/asynch_repriority/swift/local_worker_pool.sh
    CFG_NODES: 3
    CFG_PPN: 1
    CFG_PROCS: $(( CFG_NODES * CFG_PPN ))
    CFG_DB_PORT: 5433
    CFG_DB_USER: eqsql_test_user
    CFG_DB_NAME: eqsql_test_db
    CFG_DB_HOST: localhost
    CFG_BATCH_SIZE: $(( CFG_PROCS - 2 ))
    CFG_BATCH_THRESHOLD: 1

  - name: bebop
    type: funcx
    fx_endpoint: 'd526418b-8920-4bc9-a9a0-3c97e1a10d3b'
    start_pool_script: /lcrc/project/EMEWS/bebop/repos/eqsql_examples/asynch_repriority/swift/bebop_worker_pool.sh
    CFG_PPN: 36
    CFG_NODES: 1
    CFG_PROCS: $(( CFG_NODES * CFG_PPN ))
    CFG_DB_PORT: 3149
    CFG_DB_USER: collier
    CFG_DB_NAME: EQ_SQL
    CFG_BATCH_SIZE: $(( CFG_PROCS - 2 ))
    CFG_BATCH_THRESHOLD: 1
    CFG_WALLTIME: 01:00:00
    CFG_QUEUE: dis
    CFG_PROJECT: CONDO

dbs:
  - name: nc_local
    type: local
    db_host: localhost
    db_user: eqsql_test_user
    db_port: 5433
    db_name: eqsql_test_db

  # - name: bebop
  #   type: funcx
  #   fx_endpoint: d526418b-8920-4bc9-a9a0-3c97e1a10d3b
  #   db_user: collier
  #   db_port: 3149
  #   db_name: EQ_SQL
  #   db_data: /lcrc/project/EMEWS/bebop/db
  #   env:
  #     PATH: /lcrc/project/EMEWS/bebop/sfw/gcc-7.1.0/postgres-14.2/bin
  #     LD_LIBRARY_PATH': /lcrc/project/EMEWS/bebop/sfw/gcc-7.1.0/postgres-14.2/lib
  #   # start_cmd: nice -n 19 pg_ctl -D ${db_data} -l ${db_data}/db.log -o "-p ${db_port}" start
  #   start_cmd: pg_ctl -D ${db_data} -l ${db_data}/db.log -o "-p ${db_port}" start
  #   stop_cmd: pg_ctl -D ${db_data} stop

    # tunnel:
    #   host: Bebop
    #   ssh_config: /home/nick/.ssh/config
      

task_types:
  sim: 0

tasks:
  - type: sim
    pools:
      - bebop


search_space_size: 1000
sample_dimensions: 4
exp_id: async_repro
runtime: 1
runtime_var: 1
num_guesses: 500
retrain_after: 20
